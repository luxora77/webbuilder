<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Website Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: radial-gradient(circle at top, #2e1065, #020617);
}
</style>
</head>

<body class="text-slate-200">

<div class="flex flex-1 overflow-hidden">

<!-- ============ SIDEBAR ============ -->
<aside class="w-72 flex flex-col bg-black/60 backdrop-blur border-r border-white/10">

  <div class="p-4">
    <button onclick="newProject()"
      class="w-full py-2 rounded-xl font-semibold
      bg-gradient-to-r from-fuchsia-700 to-purple-700 hover:opacity-90">
      + New Project
    </button>
  </div>

  <div id="projectList" class="flex-1 overflow-y-auto px-3 space-y-2"></div>

  <div class="p-4 border-t border-white/10">
    <button onclick="openSettings()" class="w-full text-center">⚙ Settings</button>
  </div>
</aside>

<!-- ============ MAIN ============ -->
<main class="flex-1 flex flex-col overflow-hidden">

<header class="flex items-center justify-between px-4 py-3 bg-black/50 border-b border-white/10">
  <div class="flex gap-2">
    <span class="text-red-500">●</span>
    <span class="text-yellow-400">●</span>
    <span class="text-green-500">●</span>
  </div>

  <div class="flex gap-2">
    <button onclick="setView('preview')" class="px-3 py-1 bg-white/10 rounded">Preview</button>
    <button onclick="setView('code')" class="px-3 py-1 bg-white/10 rounded">Code</button>
    <button onclick="downloadHTML()"
      class="px-3 py-1 rounded font-semibold bg-gradient-to-r from-amber-500 to-yellow-400 text-black">
      Download
    </button>
  </div>
</header>

<div class="flex-1 overflow-auto p-4">
  <pre id="output"
    class="hidden whitespace-pre-wrap bg-black/70 p-4 rounded-xl border border-white/10 text-sm"></pre>

  <iframe id="preview"
    class="hidden w-full h-full rounded-xl border border-white/10 bg-white"></iframe>
</div>

<!-- ============ FOOTER CHAT ============ -->
<footer class="flex-shrink-0 bg-black/60 border-t border-white/10 p-3 space-y-2">

  <!-- MODE TOGGLE -->
  <div class="flex gap-2 text-sm">
    <button onclick="setMode('build')" id="buildBtn"
      class="px-3 py-1 rounded bg-purple-700">Build</button>
    <button onclick="setMode('customize')" id="customBtn"
      class="px-3 py-1 rounded bg-white/10">Customize</button>
  </div>

  <div class="flex gap-2">
    <textarea id="userInput"
      rows="2"
      class="flex-1 resize-none rounded-xl bg-white/10 p-3 outline-none"
      placeholder="Describe what you want..."></textarea>

    <button onclick="sendPrompt()"
      class="px-5 rounded-xl font-semibold text-black
      bg-gradient-to-r from-amber-500 to-yellow-400">
      Send
    </button>
  </div>
</footer>

</main>
</div>

<!-- ============ SETTINGS MODAL ============ -->
<div id="settingsModal"
  class="fixed inset-0 hidden items-center justify-center bg-black/70">

<div class="bg-[#0f172a] p-6 rounded-xl w-full max-w-md space-y-4">
  <input id="apiUrl" class="w-full p-2 rounded bg-black/50"
    value="https://openrouter.ai/api/v1/chat/completions" />
  <input id="apiKey" type="password" class="w-full p-2 rounded bg-black/50"
    placeholder="API Key" />
  <input id="modelId" class="w-full p-2 rounded bg-black/50"
    value="deepseek/deepseek-r1:free" />
  <div class="flex justify-end gap-2">
    <button onclick="closeSettings()">Cancel</button>
    <button onclick="saveSettings()" class="bg-purple-700 px-4 py-1 rounded">Save</button>
  </div>
</div>
</div>

<script>
/* ===== SYSTEM PROMPTS ===== */
const BUILD_PROMPT =
"You are a web developer. Create a complete website. Output ONLY raw HTML code.";

const CUSTOMIZE_PROMPT =
"You are a web developer. Modify the provided HTML as requested. Return FULL updated HTML only.";

/* ===== STATE ===== */
const DEFAULT_API_URL = "https://openrouter.ai/api/v1/chat/completions";
let mode = "build";

let state = JSON.parse(localStorage.getItem("ai_builder") || "{}");
state.projects ||= [];
state.current ||= null;
state.settings ||= {
  apiUrl: DEFAULT_API_URL,
  apiKey: "",
  model: "deepseek/deepseek-r1:free"
};

const output = document.getElementById("output");
const preview = document.getElementById("preview");

/* ===== CORE ===== */
function saveState() {
  localStorage.setItem("ai_builder", JSON.stringify(state));
}

function newProject() {
  const p = { id: Date.now(), name: "New Project", code: "" };
  state.projects.push(p);
  state.current = p.id;
  saveState();
  renderProjects();
  renderContent();
}

function renderProjects() {
  const list = document.getElementById("projectList");
  list.innerHTML = "";
  state.projects.forEach(p => {
    const b = document.createElement("button");
    b.textContent = p.name;
    b.className = "w-full px-3 py-2 rounded bg-white/5 hover:bg-white/10";
    b.onclick = () => { state.current = p.id; renderContent(); };
    list.appendChild(b);
  });
}

function renderContent() {
  const p = state.projects.find(x => x.id === state.current);
  if (!p) return;
  output.textContent = p.code;
  preview.srcdoc = p.code;
}

function setView(v) {
  output.classList.toggle("hidden", v !== "code");
  preview.classList.toggle("hidden", v !== "preview");
}

function setMode(m) {
  mode = m;
  document.getElementById("buildBtn").className =
    m === "build" ? "px-3 py-1 rounded bg-purple-700" : "px-3 py-1 rounded bg-white/10";
  document.getElementById("customBtn").className =
    m === "customize" ? "px-3 py-1 rounded bg-purple-700" : "px-3 py-1 rounded bg-white/10";
}

/* ===== API CALL ===== */
async function sendPrompt() {
  const textInput = document.getElementById("userInput").value.trim();
  if (!textInput) return;

  const p = state.projects.find(x => x.id === state.current);
  if (!p) return;

  let messages = [];

  if (mode === "build") {
    messages = [
      { role: "system", content: BUILD_PROMPT },
      { role: "user", content: textInput }
    ];
  } else {
    messages = [
      { role: "system", content: CUSTOMIZE_PROMPT },
      { role: "user", content: "CURRENT HTML:\n" + p.code },
      { role: "user", content: "CHANGE REQUEST:\n" + textInput }
    ];
  }

  const res = await fetch(state.settings.apiUrl, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + state.settings.apiKey
    },
    body: JSON.stringify({
      model: state.settings.model,
      messages
    })
  });

  const raw = await res.text();
  if (!res.ok) {
    alert("API Error: " + raw);
    return;
  }

  const data = JSON.parse(raw);
  p.code = data.choices[0].message.content;
  saveState();
  renderContent();
}

/* ===== UTIL ===== */
function downloadHTML() {
  const p = state.projects.find(x => x.id === state.current);
  if (!p) return;
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([p.code], { type: "text/html" }));
  a.download = "index.html";
  a.click();
}

function openSettings() {
  document.getElementById("settingsModal").classList.remove("hidden");
}
function closeSettings() {
  document.getElementById("settingsModal").classList.add("hidden");
}
function saveSettings() {
  state.settings.apiUrl = document.getElementById("apiUrl").value;
  state.settings.apiKey = document.getElementById("apiKey").value;
  state.settings.model = document.getElementById("modelId").value;
  saveState();
  closeSettings();
}

renderProjects();
setView("preview");
</script>

</body>
</html>
